<!DOCTYPE html>
<html>
  <head>
    <title>Mapa de información por país Covid-19, en colaboración con los Alumnos de 6o Semestre de Sistemas de la Universidad DeLasalle Bajío hemos creado un mapa mundial con los casos de Covid-19 en tiempo real</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="57x57" href="img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="img/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Barlow Condensed' rel='stylesheet'>
    <link href='screen.css' rel='stylesheet'>
    <script src="https://kit.fontawesome.com/b23a88639a.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        .float{
	position:fixed;
	width:60px;
	height:60px;
	bottom:40px;
	right:40px;
	background-color:white;
	color:black;
	border-radius: 4px 0 0 4px;
	text-align:center;
    -webkit-box-shadow: 0px 10px 23px -13px grey;
    box-shadow: 0px 10px 23px -13px grey;

}

.my-float{
	margin-top:22px;
}
 
        a:hover{
            color: #B40404;
            text-decoration:underline;
        }
      #map {
        height: 100%;
      }
 
      html, body {
        height: 100%;
        margin: 0;
        padding: 0; 
    /*overflow-y: hidden !important;*/
      }
      #chart { 
          width: 97%; 
        min-height: 300px;
         }
      #div-mostrar{
	margin: auto;
	height: 0px;
	transition: height .4s;
    text-align: center; 
        }
        .imagenpin{ 
         border:1px solid #AAA;
        }
    </style>
  </head>
  <body >  
        <div class="container">
            <div class="header__nav__list__container">
                <header class="header header-menu header--fixed header--home header--scroll-links">
                    <div class="container">
                        <div class="header__container">
                            <a href="javascript:void(0)" onclick="divAuto()" class="btn-hamburger">
                                 <!--//*background-color:#000;content:'';*/-->
                                <span class="fas fa-search" id="btnsearch"></span> 
                            </a>
                            <h1 class="logo logo--site"><a ></a></h1>
                        </div>
                        <!--/header__container-->
                    </div>

                    <!--/container-->
                </header>
                <!--/header-->
            <div class="menu_container" id="div-mostrar" style="display:none;background-color: #fff;
            position: relative!important;
            z-index: 10; text-align: inherit;">
                <div class="row " style="height: 100px;width: 100%;">
                    <div class="col-xs-12 col-md-12">
                        <div class="row" style="height: 100px;width: 100%;">
                        <div class="col-xs-6 col-md-6 mt-10 pb-5" style="width: 100%;"></div>
                        <div class="col-xs-2 col-md-2 mt-10 pb-5" style="padding-top: 40px;">
                            
                        </div>
                        <div class="col-xs-2 col-md-2 mt-10 pb-5" style="padding-top: 40px;">
                           
                        </div>
                        <div class="col-xs-2 col-md-2 mt-10 pb-5" style="padding-top: 40px;">
                            
                        </div>
                        </div>
                    </div>
                </div>
                <div class="row pb-5">
                    <div class="col-xs-4 col-md-4" >
                        <div class="alert alert-info" role="alert">
                            <h4 class="alert-heading" style="text-transform: uppercase;">Nivel global</h4>
                            <hr>
                            <p><span>Casos: </span><span id="txtconfirmedglobal"></span><br>
                                <span>Nuevos: </span><span id="txtnewcasesglobal"></span></p>

                                <br>
                                <br>
                                <p><span>Recuperados:</span><br><span id="txtrecoveredglobal"></span></p>

                                <br>
                                <br>

                                <p><span>Muertes: </span><span id="txtdeathsglobal"></span>
                                    <br>
                                    <span>Nuevas: </span><span id="txtnewdeathsglobal"></span></p>
                            <hr>
                            <p class="mb-0"><a href="https://rapidapi.com/astsiatsko/api/coronavirus-monitor/details" target="_blank">coronavirus-monitor</a></p>
                          </div>
                    </div>
                    <div class="col-xs-4 col-md-4 mt-10">
                            <form>
                                
                                <small  class="form-text text-muted">Ultimo estado de cada pais.</small>
                                <div class="form-group">
                                  <select class="form-control mt-5" name="provincia">
                                    <option>Seleccione un pais...</option>
                                   </select>
                                </div>
                                <button type="button" onclick="search()" class="btn btn-danger" >Buscar</button>
                              </form>
                              <div id="alertsearch" class="alert alert-warning mt-5" role="alert" style="display:none;">
                                Seleccione un  pais!
                              </div> 
                              <div class="mt-10" id="chart" style="display: none;margin-top: 40px;">
                                <div id="chart_div"></div> 
                              </div>
                    </div>
                    <div class="col-xs-4 col-md-4  mt-10" >
                        <ul class="list-group mt-5">
                            <li class="list-group-item d-flex justify-content-between align-items-center disabled" id="paiss">
                                Seleccione un pais...
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Total de casos
                              <span class="badge badge-danger badge-pill" id="tcs"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Nuevos casos
                              <span class="badge badge-warning badge-pill" id="ncs"></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                Casos activos
                                <span class="badge badge-primary badge-pill" id="cas"></span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                Total de muertes
                                <span class="badge badge-dark badge-pill" id="tms"></span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                Nuevas muertes
                                <span class="badge badge-secondary badge-pill" id="nms"></span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                Total de recuperados
                                <span class="badge badge-success badge-pill" id="trs"></span>
                              </li>
                              <li class="list-group-item d-flex justify-content-between align-items-center">
                                Criticos
                                <span class="badge badge-danger badge-pill" id="cs"></span>
                              </li>
                          </ul>
                          
                        <small  class="form-text text-muted" id="record_dates"></small>
                    </div>
                  </div>
            </div>
            <!--/menu_container-->
            </div>
        </div>
    <!--/header__nav-->
    <div id="map" style="display: block;"></div> 
    <!--<a href="javascript:void(0)" class="float">
        <i class="fas fa-search my-float"></i>
        </a>-->

    <script>
 var clic = 1;
function divAuto(){ 
   if(clic==1){
   document.getElementById("btnsearch").className ="";
  document.getElementById("btnsearch").className ='fas fa-times';
   document.getElementById("div-mostrar").style.height = "100%";
   
   document.getElementById("div-mostrar").style.display = 'block';
   document.getElementById("map").style.display = 'none';
   document.getElementById("chart_div").innerHTML = "";
   clic = clic + 1;
   } else{
   document.getElementById("btnsearch").className ="";
  document.getElementById("btnsearch").className ='fas fa-search';   
    document.getElementById("div-mostrar").style.height = "0px";   

    document.getElementById("chart").style.display = 'none'; 
    document.getElementById("chart_div").innerHTML = "";
    document.getElementById('record_dates').innerHTML = "";
    document.getElementById('paiss').innerHTML = "Seleccione un pais...";
    document.getElementById('tcs').innerHTML = "";
    document.getElementById('ncs').innerHTML = "";
    document.getElementById('cas').innerHTML = "";
    document.getElementById('tms').innerHTML = "";
    document.getElementById('nms').innerHTML = "";
    document.getElementById('cs').innerHTML = "";
    document.getElementById('trs').innerHTML = "";
    document.getElementsByName("provincia")[0].value = "Seleccione un pais...";


    document.getElementById("div-mostrar").style.display = 'none';
    document.getElementById("map").style.display = 'block';
    clic = 1;
   }   
}

function search(){
    let element = document.getElementsByName("provincia")[0];
    if(element.value!="Seleccione un pais..."){

  document.getElementById("alertsearch").style.display = 'none';
  document.getElementById("chart_div").innerHTML = "";
  document.getElementById("chart").style.display = 'block';
    var country=element.value;
     fetch("https://coronavirus-monitor.p.rapidapi.com/coronavirus/latest_stat_by_country.php?country="+country, {
	"method": "GET",
	"headers": {
		"x-rapidapi-host": "coronavirus-monitor.p.rapidapi.com",
		"x-rapidapi-key": "32e27eda20msh4d6db7d143a67c6p155a35jsn03c763a6fb2d"
	}
})
    .then(response => {
        response.json().then(function(datos) { 
            var pais=datos.country;
            var array=datos.latest_stat_by_country;
            
            document.getElementById('record_dates').innerHTML = "Seleccione un pais...";
            document.getElementById('record_dates').innerHTML = array[0].record_date;

            document.getElementById('paiss').innerHTML = "";
            document.getElementById('paiss').innerHTML = pais;

            document.getElementById('tcs').innerHTML = "";
            document.getElementById('tcs').innerHTML =(array[0].total_cases == '') ? 0 : array[0].total_cases;

            document.getElementById('ncs').innerHTML = "";
            document.getElementById('ncs').innerHTML = (array[0].new_cases == '') ? 0 : array[0].new_cases;

            document.getElementById('cas').innerHTML = "";
            document.getElementById('cas').innerHTML = (array[0].active_cases == '') ? 0 : array[0].active_cases;

            document.getElementById('tms').innerHTML = "";
            document.getElementById('tms').innerHTML = (array[0].total_deaths == '') ? 0 : array[0].total_deaths;

            document.getElementById('nms').innerHTML = "";
            document.getElementById('nms').innerHTML =  (array[0].new_deaths == '') ? 0 : array[0].new_deaths;

            document.getElementById('trs').innerHTML = "";
            document.getElementById('trs').innerHTML = (array[0].total_recovered == '') ? 0 : array[0].total_recovered;

            document.getElementById('cs').innerHTML = "";
            document.getElementById('cs').innerHTML = (array[0].serious_critical == '') ? 0 : array[0].serious_critical;
        });
    })
    .catch(err => {
        console.log(err);
    });

    fetch("https://covid-193.p.rapidapi.com/history?country="+country, {
	"method": "GET",
	"headers": {
		"x-rapidapi-host": "covid-193.p.rapidapi.com",
		"x-rapidapi-key": "32e27eda20msh4d6db7d143a67c6p155a35jsn03c763a6fb2d"
	}
    })
    .then(response => { 
        response.json().then(function(p) {

            var array=p.response.reverse(); 

        google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() 
      {

        var data = new google.visualization.DataTable();
        data.addColumn('date', 'Fecha');
        data.addColumn('number', 'Casos');

          
        var dataChart = [];
        for(var i=0;i<array.length;i++){ 
                   
                    let date =array[i].day;
                    var splitDate = date.split('-');
                    var year = splitDate[0];
                    var month = splitDate[1];
                    var day = splitDate[2]; 
                    dataChart.push( [new Date(year,parseInt(month)-1,parseInt(day)),array[i].cases.total] );
                }
        data.addRows(dataChart);


        var options = {
          title: 'Historial de '+p.parameters.country, 
          height: 300,
          animation:{
						duration: 1000,
						easing: 'linear',
						startup: true
					},
          colors: ['#B40404'],
          pointSize: 5,
          pointShape: 'square', 
          explorer: { 
                    actions: ['dragToZoom', 'rightClickToReset'],
                    axis: 'horizontal',
                    keepInBounds: true,
                    maxZoomIn: 4.0
                    },
          hAxis: {
            format: 'yy/M/d',
            gridlines: {count: 15},
            title: 'Dia',  titleTextStyle: {color: '#333'},
            slantedText:true, 
            slantedTextAngle:80
          },
          vAxis: {
            gridlines: {color: 'none'},
            minValue: 0
          }
        };

        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        
          chart.draw(data, options); 
          window.addEventListener('resize', drawChart, false);
      }
      

        });
    })
    .catch(err => {
        console.log(err);
    });



    }
    else{
  document.getElementById("alertsearch").style.display = 'block';
  document.getElementById("chart").style.display = 'none';
  document.getElementById("chart_div").innerHTML = "";

    document.getElementById('record_dates').innerHTML = "";
    document.getElementById('paiss').innerHTML = "Seleccione un pais...";
    document.getElementById('tcs').innerHTML = "";
    document.getElementById('ncs').innerHTML = "";
    document.getElementById('cas').innerHTML = "";
    document.getElementById('tms').innerHTML = "";
    document.getElementById('nms').innerHTML = "";
    document.getElementById('cs').innerHTML = "";
    document.getElementById('trs').innerHTML = "";
    }
}
    var coordenadas = {
        lat: 0, 
        lng: 0
        }

    var propiedades = {
        center: coordenadas,
        zoom: 3,
        disableDefaultUI: true,
        mapTypeControl: false,
        
        panControl:false,
        zoomControl:true,
        scaleControl:false,
        streetViewControl:false,
        overviewMapControl:false,
        rotateControl:false
        }

 

    function iniciaMapa() {

        
                    
        var lista;
        fetch('paises.json')
        .then(function(response) {
        response.json().then(function(datos) {
        lista=datos;
        });
        })
        .catch(function(error) {
                console.log('Hubo un problema con la petición Fetch:' + error.message);
        });
        
        var latitud=0,longitud=0,flag="";     
        fetch('https://corona.lmao.ninja/countries')
        .then(function(respuesta) {
                        respuesta.json().then(function(datospaises) {
                            const map = new google.maps.Map(document.getElementById('map'), propiedades);
                            datospaises.forEach( registro => {
                                if(registro.countryInfo.lat==0 && registro.countryInfo.long==0){
                                    lista.forEach( element => {
                                            if(registro.country==element.CountryName){
                                                longitud=element.CapitalLongitude;
                                                latitud=element.CapitalLatitude;
                                                flag="<img class=imagenpin src="+"https://www.countryflags.io/"+element.CountryCode +"/flat/64.png"+">";
                                            }
                                            });
                                }else{
                                    latitud=registro.countryInfo.lat;
                                    longitud=registro.countryInfo.long;
                                    flag="<img class=imagenpin width="+60+" height="+40+" src="+registro.countryInfo.flag+">";
                                }

                                if(registro.countryInfo.lat==0 && registro.countryInfo.long==0){
                                   // console.log(latitud+","+longitud+","+flag);
                                }
                                    
                                    var información = flag +"<br><br><strong>País:</strong> "+ registro.country +"<br><strong>Casos:</strong> " + registro.cases + "<br><strong>Nuevos hoy:</strong> " + registro.todayCases + "<br><strong>Muertes:</strong> " + registro.deaths + "<br><strong>Muertes Hoy:</strong> " + registro.todayDeaths + "<br><strong>Recuperados:</strong> " + registro.recovered + "<br><strong>Activos:</strong> " + registro.active + "<br><strong>Críticos:</strong> " + registro.critical + "<br><strong>Casos por millón:</strong> " + registro.casesPerOneMillion;
                                   
                                    var infowindow = new google.maps.InfoWindow({
                                        content: información
                                    });

                                    var icono = {
                                        url: "img/covid-icon.png", // url imagen
                                        scaledSize: new google.maps.Size(50, 50)
                                    };

                                    let marker = new google.maps.Marker({
                                        map: map,
                                        position: new google.maps.LatLng(latitud,longitud),
                                        title: registro.country,
                                        icon: {
                                            scaledSize: new google.maps.Size(20,20),
    url: 'data:image/svg+xml;utf-8, \
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="biohazard" class="svg-inline--fa fa-biohazard fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="darkred" stroke="red" d="M287.9 112c18.6 0 36.2 3.8 52.8 9.6 13.3-10.3 23.6-24.3 29.5-40.7-25.2-10.9-53-17-82.2-17-29.1 0-56.9 6-82.1 16.9 5.9 16.4 16.2 30.4 29.5 40.7 16.5-5.7 34-9.5 52.5-9.5zM163.6 438.7c12-11.8 20.4-26.4 24.5-42.4-32.9-26.4-54.8-65.3-58.9-109.6-8.5-2.8-17.2-4.6-26.4-4.6-7.6 0-15.2 1-22.5 3.1 4.1 62.8 35.8 118 83.3 153.5zm224.2-42.6c4.1 16 12.5 30.7 24.5 42.5 47.4-35.5 79.1-90.7 83-153.5-7.2-2-14.7-3-22.2-3-9.2 0-18 1.9-26.6 4.7-4.1 44.2-26 82.9-58.7 109.3zm113.5-205c-17.6-10.4-36.3-16.6-55.3-19.9 6-17.7 10-36.4 10-56.2 0-41-14.5-80.8-41-112.2-2.5-3-6.6-3.7-10-1.8-3.3 1.9-4.8 6-3.6 9.7 4.5 13.8 6.6 26.3 6.6 38.5 0 67.8-53.8 122.9-120 122.9S168 117 168 49.2c0-12.1 2.2-24.7 6.6-38.5 1.2-3.7-.3-7.8-3.6-9.7-3.4-1.9-7.5-1.2-10 1.8C134.6 34.2 120 74 120 115c0 19.8 3.9 38.5 10 56.2-18.9 3.3-37.7 9.5-55.3 19.9-34.6 20.5-61 53.3-74.3 92.4-1.3 3.7.2 7.7 3.5 9.8 3.3 2 7.5 1.3 10-1.6 9.4-10.8 19-19.1 29.2-25.1 57.3-33.9 130.8-13.7 163.9 45 33.1 58.7 13.4 134-43.9 167.9-10.2 6.1-22 10.4-35.8 13.4-3.7.8-6.4 4.2-6.4 8.1.1 4 2.7 7.3 6.5 8 39.7 7.8 80.6.8 115.2-19.7 18-10.6 32.9-24.5 45.3-40.1 12.4 15.6 27.3 29.5 45.3 40.1 34.6 20.5 75.5 27.5 115.2 19.7 3.8-.7 6.4-4 6.5-8 0-3.9-2.6-7.3-6.4-8.1-13.9-2.9-25.6-7.3-35.8-13.4-57.3-33.9-77-109.2-43.9-167.9s106.6-78.9 163.9-45c10.2 6.1 19.8 14.3 29.2 25.1 2.5 2.9 6.7 3.6 10 1.6s4.8-6.1 3.5-9.8c-13.1-39.1-39.5-72-74.1-92.4zm-213.4 129c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"></path></svg>'
  }
                                    });

                                    marker.addListener('click', function() {
                                        infowindow.open(map, marker);
                                    });

                            });

                        });

                    })
        .catch(function(error) {
            console.log('Hubo un problema con la petición Fetch:' + error.message);
        });
        










        
        fetch("https://coronavirus-monitor.p.rapidapi.com/coronavirus/worldstat.php", {
            "method": "GET",
            "headers": {
                "x-rapidapi-host": "coronavirus-monitor.p.rapidapi.com",
                "x-rapidapi-key": "32e27eda20msh4d6db7d143a67c6p155a35jsn03c763a6fb2d"
            }
        })
        .then(response => {
           
            response.json().then(function(dato) {
                //console.log(dato);
                
                
                document.getElementById('txtconfirmedglobal').innerHTML = "";
                document.getElementById('txtnewcasesglobal').innerHTML = "";
                document.getElementById('txtrecoveredglobal').innerHTML = "";
                document.getElementById('txtdeathsglobal').innerHTML = "";
                document.getElementById('txtnewdeathsglobal').innerHTML = "";
                document.getElementById('txtconfirmedglobal').innerHTML =dato.total_cases;
                document.getElementById('txtnewcasesglobal').innerHTML = dato.new_cases;
                document.getElementById('txtrecoveredglobal').innerHTML= dato.total_recovered;
                document.getElementById('txtdeathsglobal').innerHTML = dato.total_deaths;
                document.getElementById('txtnewdeathsglobal').innerHTML = dato.new_deaths;
            
            });
        })
        .catch(err => {
            console.log(err);
        });
        
        affected();
        
    }
    function affected(){
        fetch("https://coronavirus-monitor.p.rapidapi.com/coronavirus/affected.php", {
        "method": "GET",
        "headers": {
            "x-rapidapi-host": "coronavirus-monitor.p.rapidapi.com",
            "x-rapidapi-key": "32e27eda20msh4d6db7d143a67c6p155a35jsn03c763a6fb2d"
        }
        })
        .then(response => {
            var select = document.getElementsByName("provincia")[0];
            response.json().then(function(p) {
               
                p.affected_countries.sort();
                for(var i=0;i<p.affected_countries.length;i++){
                    var option = document.createElement("option");
                    option.text = p.affected_countries[i];
                    select.add(option);
                }
            });
        })
        .catch(err => {
            console.log(err);
        });
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADjOfdGIg-7JiqjoTstMN9el4g-nLhxxA&callback=iniciaMapa"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    
  </body>
</html>
